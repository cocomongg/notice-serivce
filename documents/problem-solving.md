## 핵심 문제해결 전략

공지사항 도메인 특성상, 등록/수정/삭제보다 조회가 훨씬 빈번하게 발생할 것으로 예상되어, 조회 성능 최적화를 중점으로 문제해결 전략을 수립하였습니다.<br/>
또한 파일 업로드와 관련해서는 향후 확장성을 고려하여 다형성을 활용한 설계를 적용하였습니다.

### 1. 대용량 트래픽을 고려한 캐싱 적용
- **문제점:**  
  대용량 트래픽 상황에서 조회 요청이 급증하면 데이터베이스 부하가 증가하여 성능 저하 및 사용자 경험 저하가 발생할 수 있습니다.
<br/><br/>

- **해결방법:**
    - **Redis 캐시 도입:**
        - 공지사항 **목록 조회**와 **상세 조회** 결과를 Redis에 캐싱하여 동일한 요청에 대해 데이터베이스 조회에 대한 부하를 최소화하였습니다.<br/>
        - Local Cache는 메모리 사용량에 한계가 있고,  분산 환경에서 캐시 일관성을 보장하기 어렵기 때문에 Redis를 선택하였습니다.
    - **캐시 키 구성:**
        - 조회 조건(페이지 번호, 페이지 크기, 검색 조건 등)을 고려한 캐시 키를 생성할때, hash 값을 통해서 키를 생성할 수도 있지만, <br/>
          유지보수나 가독성을 고려하여 별도의 `KeyGenerator`를 구현하여 key를 관리했습니다.
    - **캐시 무효화:**
        - 적절한 캐시 무효화를 적용하여, 데이터 불일치 문제를 방지하고 최신 데이터를 제공하도록 하였습니다.
        - 공지사항 등록 시, 목록 조회 캐시/상세 조회 캐시 무효화
        - 공지사항 수정 시, 목록 조회 캐시 무효화/ 해당 key에 맞는 상세 조회 캐시 갱신
        - 공지사항 삭제 시, 목록 조회 캐시 무효화/ 해당 key에 맞는 상세 조회 캐시 무효화
<br/><br/>

### 2. 조회수 동시성 문제 및 업데이트 최적화

- **문제점:**  
  여러 사용자가 동시에 공지사항을 조회할 경우 동시성 문제가 발생하여 조회수가 정확하게 반영되지 않거나, 조회 시마다 데이터베이스의 조회수 업데이트로 인해 부하가 증가할 수 있습니다.
<br/><br/>

- **해결 전략:**
    - **Redis를 활용한 조회수 관리:**
        - db lock(x-lock 등)으로도 동시성 문제를 해결할 수 있지만, 조회수 증가 업데이트로 인한 데이터베이스 부하는 여전히 발생할 수 있으며,<br/>
          db lock으로 인해 시스템 성능 저하가 발생할 여지가 있습니다.<br/>
        - Redis를 사용하여 원자적 연산인 `INCR` 명령어를 통해 조회수 증가에 대한 동시성 문제를 해결하고, 업데이트에 대한 데이터베이스의 부하를 줄이고자 했습니다.
        - 메모리는 휘발성 데이터이기 때문에, 주기적으로 데이터베이스에 조회수를 업데이트하는 방법을 선택하였습니다.
    - **중복 조회 방지:**
        - 게시글에 대한 조회수는 noticeId를 key로 하여 String 자료구조를 사용해서 관리했습니다.
        - 같은 사용자가 중복으로 조회수를 증가시키는 어뷰징을 방지하기 위해, Set 자료구조를 사용해서 userId를 Key로 하고, value에 noticeId를 저장했습니다.
            - 해당 Set 자료구조는 TTL을 설정하여, 자정이 지나면 만료처리가 되도록 했습니다.

### 3. 파일 업로드
- **문제점:**  
  Cloud Storage 서비스(AWS S3, Azure Blob Storage 등)를 사용하면 presigned URL과 CDN을 통해 서버 부하를 줄이고 파일 업로드 속도를 높일 수 있지만,<br/>
  시간 관계상 본 구현에서는 적용하지 못하였습니다. 다만 추후에 확장성을 고려하여 다형성을 활용하여 구현했습니다.
<br/><br/>

- **해결 전략:**
  - `StorageService` 인터페이스를 정의하고, 이를 구현한 `FileSystemStorageService`를 통해 로컬 파일 시스템에 저장하도록 구현했습니다.
  - 추후에 cloud storage 서비스를 사용할 경우, `CloudStorageService`를 구현하여, `StorageService`를 대체할 수 있도록 확장성을 고려했습니다.
  - 또한 파일 업로드 기능을 api로 따로 분리하여, 추후에 presignedUrl을 이용할 경우 최대한 변경사항이 적게 적용할 수 있도록 구현했습니다.
<br/><br/>